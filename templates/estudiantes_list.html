{% extends "base.html" %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
  <h1 class="mb-0">Estudiantes</h1>
  <a class="btn btn-primary" href="/estudiantes/nuevo/">Nuevo Estudiante</a>
</div>

<!-- Búsqueda y Filtros -->
<div class="card mb-4">
  <div class="card-body">
    <form method="get" class="row g-3">
      <div class="col-md-6">
        <label class="form-label">Buscar</label>
        <input type="text" name="q" class="form-control" placeholder="Nombre, matrícula, correo o carrera..." value="{{ query }}">
      </div>
      <div class="col-md-4">
        <label class="form-label">Filtrar por carrera</label>
        <select name="carrera" class="form-select">
          <option value="">Todas las carreras</option>
          {% for carrera in carreras %}
            <option value="{{ carrera }}" {% if carrera_filter == carrera %}selected{% endif %}>{{ carrera }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="col-md-2 d-flex align-items-end">
        <button type="submit" class="btn btn-primary w-100">Buscar</button>
      </div>
      {% if query or carrera_filter %}
      <div class="col-12">
        <a href="/estudiantes/" class="btn btn-outline-secondary btn-sm">Limpiar filtros</a>
      </div>
      {% endif %}
    </form>
  </div>
</div>

<div class="card">
  <div class="card-body table-responsive">
    <table class="table table-striped align-middle">
      <thead>
        <tr>
          <th>Matrícula</th>
          <th>Nombre</th>
          <th>Carrera</th>
          <th>Correo</th>
          <th class="text-end">Acciones</th>
        </tr>
      </thead>
      <tbody>
        {% for e in estudiantes %}
        <tr>
          <td>{{ e.matricula }}</td>
          <td>{{ e.nombre }} {{ e.apellido }}</td>
          <td>{{ e.carrera }}</td>
          <td>{{ e.correo }}</td>
          <td class="text-end">
            <a class="btn btn-sm btn-outline-secondary" href="/estudiantes/{{ e.id }}/editar/">Editar</a>
            <a class="btn btn-sm btn-outline-danger" href="/estudiantes/{{ e.id }}/eliminar/">Eliminar</a>
          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="5" class="text-center text-muted">No se encontraron estudiantes{% if query or carrera_filter %} con los filtros aplicados{% endif %}.</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  {% if estudiantes.has_other_pages %}
  <div class="card-footer">
    <nav aria-label="Navegación de páginas">
      <ul class="pagination justify-content-center mb-0">
        {% if estudiantes.has_previous %}
          <li class="page-item"><a class="page-link" href="?page=1{% if query %}&q={{ query }}{% endif %}{% if carrera_filter %}&carrera={{ carrera_filter }}{% endif %}">Primera</a></li>
          <li class="page-item"><a class="page-link" href="?page={{ estudiantes.previous_page_number }}{% if query %}&q={{ query }}{% endif %}{% if carrera_filter %}&carrera={{ carrera_filter }}{% endif %}">Anterior</a></li>
        {% endif %}
        <li class="page-item active"><span class="page-link">Página {{ estudiantes.number }} de {{ estudiantes.paginator.num_pages }}</span></li>
        {% if estudiantes.has_next %}
          <li class="page-item"><a class="page-link" href="?page={{ estudiantes.next_page_number }}{% if query %}&q={{ query }}{% endif %}{% if carrera_filter %}&carrera={{ carrera_filter }}{% endif %}">Siguiente</a></li>
          <li class="page-item"><a class="page-link" href="?page={{ estudiantes.paginator.num_pages }}{% if query %}&q={{ query }}{% endif %}{% if carrera_filter %}&carrera={{ carrera_filter }}{% endif %}">Última</a></li>
        {% endif %}
      </ul>
    </nav>
  </div>
  {% endif %}
</div>
{% endblock %}


